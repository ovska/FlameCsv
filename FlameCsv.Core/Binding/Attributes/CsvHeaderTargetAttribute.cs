using System.Collections.Immutable;
using CommunityToolkit.Diagnostics;

namespace FlameCsv.Binding.Attributes;

/// <summary>
/// Binds <see cref="MemberName"/> to columns whose header matches with the provided values.
/// Use if <see cref="CsvHeaderAttribute"/> cannot be used on a member directly, e.g. on autogenerated partial classes.
/// </summary>
/// <remarks>
/// Not applicable for constructor parameters. Instead, create another constructor in the partial file with
/// <see cref="CsvConstuctorAttribute"/>, and add an unused parameter with <see cref="CsvHeaderExcludeAttribute"/>
/// or change the parameter order.
/// </remarks>
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct, AllowMultiple = true)]
public sealed class CsvHeaderTargetAttribute : Attribute
{
    /// <summary>Header values to match.</summary>
    public ImmutableArray<string> Values { get; }

    /// <summary>Name of the property or field.</summary>
    public string MemberName { get; }

    /// <inheritdoc cref="CsvHeaderAttribute.Order"/>
    public int Order { get; set; } = 1;

    /// <inheritdoc cref="CsvHeaderTargetAttribute"/>
    /// <param name="memberName">Name of the property or field</param>
    /// <param name="value">Header column value</param>
    public CsvHeaderTargetAttribute(
        string memberName,
        string value)
    {
        Guard.IsNotNullOrWhiteSpace(memberName);
        Values = ImmutableArray.Create(value);
        MemberName = memberName;
    }

    /// <inheritdoc cref="CsvHeaderTargetAttribute"/>
    /// <param name="memberName">Name of the property or field</param>
    /// <param name="values">Header column value</param>
    public CsvHeaderTargetAttribute(
        string memberName,
        params string[] values)
    {
        Guard.IsNotNullOrWhiteSpace(memberName);
        Guard.IsNotNull(values);
        Values = values.ToImmutableArray();
        MemberName = memberName;
    }
}
